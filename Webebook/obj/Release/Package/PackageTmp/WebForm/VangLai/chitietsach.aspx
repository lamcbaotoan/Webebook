<%@ Page Title="Chi Tiết Sách" Language="C#" MasterPageFile="~/WebForm/VangLai/Site.Master" AutoEventWireup="true" CodeBehind="chitietsach.aspx.cs" Inherits="Webebook.WebForm.VangLai.chitietsach" %>

<asp:Content ID="Content1" ContentPlaceHolderID="HeadContent" runat="server">
     <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
     <style>
        /* Giữ lại CSS cần thiết */
        .line-clamp-3 { overflow: hidden; display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 3; max-height: 4.5em; line-height: 1.5em; }
        .line-clamp-full { max-height: none; -webkit-line-clamp: unset; }
        .collapsible-content { transition: max-height 0.3s ease-out; }
        .prose-custom p { margin-bottom: 0.75em; }
        .prose-custom br { margin-bottom: 0.5em !important; display: block; content: ""; }
        .book-cover-img { width: 100%; height: auto; max-height: 500px; object-fit: contain; background-color: #f9fafb; }
        /* Xóa CSS cho rec-book-cover-img vì section đã bị xóa */
        a, button, input, select, asp:Button, asp:LinkButton { transition: all 0.15s ease-in-out; }
        /* Popup Style */
        .popup-overlay { position: fixed; inset: 0; background-color: rgba(0,0,0,0.6); z-index: 40; display: none; opacity: 0; transition: opacity 0.2s ease-out; }
        .popup-content { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.95); background-color: white; padding: 1.5rem 2rem; border-radius: 0.75rem; box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1); z-index: 50; display: none; text-align: center; max-width: 90%; width: 380px; opacity: 0; transition: opacity 0.2s ease-out, transform 0.2s ease-out; }
        .popup-overlay.visible, .popup-content.visible { display: block; opacity: 1; transform: translate(-50%, -50%) scale(1); }
     </style>
</asp:Content>

<asp:Content ID="Content2" ContentPlaceHolderID="MainContent" runat="server">
    <div class="container mx-auto px-4 py-6 md:py-8">
        <asp:Label ID="lblMessage" runat="server" EnableViewState="false" Visible="false"></asp:Label>
        <div id="bookDetailContainer" runat="server">
            <div class="bg-white p-6 md:p-8 rounded-2xl shadow-xl mb-10 border border-gray-100 flex flex-col lg:flex-row gap-6 md:gap-8">
                <%-- Cột Ảnh Bìa --%>
                <div class="w-full lg:w-1/3 flex justify-center items-start">
                    <asp:Image ID="imgBiaSach" runat="server" CssClass="book-cover-img rounded-lg shadow-md border border-gray-200" AlternateText="Ảnh bìa sách" ImageUrl='<%# GetImageUrl(Eval("DuongDanBiaSach")) %>' />
                </div>
                <%-- Cột Thông Tin --%>
                <div class="w-full lg:w-2/3 flex flex-col">
                     <%-- ... (Thông tin sách, giá, nút bấm Vãng Lai giữ nguyên) ... --%>
                     <h1 class="text-2xl lg:text-3xl font-bold text-gray-900 mb-3 leading-tight"><asp:Literal ID="litTenSach" runat="server"></asp:Literal></h1>
                     <div class="mb-4 flex flex-wrap items-center gap-2"> <asp:Repeater ID="rptGenres" runat="server"><ItemTemplate><span class="inline-block px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 border border-indigo-200"><%# Container.DataItem %></span></ItemTemplate></asp:Repeater> <asp:Label ID="lblLoaiSach" runat="server" Visible="false" CssClass="inline-block px-2.5 py-0.5 rounded-full text-xs font-semibold bg-emerald-100 text-emerald-800 border border-emerald-200"></asp:Label> </div>
                     <div class="text-sm text-gray-600 space-y-1.5 mb-5"> <p><strong class="font-medium text-gray-700">Tác giả:</strong> <asp:Label ID="lblTacGia" runat="server">[Chưa cập nhật]</asp:Label></p> <p><strong class="font-medium text-gray-700">Nhóm dịch:</strong> <asp:Label ID="lblNhomDich" runat="server">[Chưa cập nhật]</asp:Label></p> <p><strong class="font-medium text-gray-700">Trạng thái:</strong> <asp:Label ID="lblTrangThai" runat="server">[Chưa cập nhật]</asp:Label></p> </div>
                     <div class="bg-gradient-to-r from-gray-50 to-gray-100 p-4 rounded-lg mb-6 border flex flex-col sm:flex-row items-center justify-between gap-4"> <p class="text-3xl font-bold text-red-600"><asp:Label ID="lblGiaSach" runat="server">[Giá liên hệ]</asp:Label></p> <div class="flex items-center space-x-3 w-full sm:w-auto"> <asp:LinkButton ID="btnThemGioHang" runat="server" ToolTip="Thêm vào giỏ hàng" CssClass="inline-flex items-center justify-center px-5 py-2.5 bg-blue-600 text-white font-semibold rounded-lg shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed" OnClientClick="showCartLoginPopup(); return false;"><i class="fas fa-cart-plus mr-1"></i> Thêm vào giỏ</asp:LinkButton> <asp:LinkButton ID="btnMuaNgay" runat="server" ToolTip="Mua ngay sản phẩm này" CssClass="inline-flex items-center justify-center px-5 py-2.5 bg-emerald-500 text-white font-semibold rounded-lg shadow-sm hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-400 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed" OnClientClick="showBuyLoginPopup(); return false;"><i class="fas fa-shopping-bag mr-1"></i> Mua ngay</asp:LinkButton> </div> </div>
                     <%-- Phần Mô tả --%>
                      <div class="mt-auto border-t border-gray-200 pt-5">
                         <h3 class="text-lg font-semibold text-gray-800 mb-2">Mô tả chi tiết</h3>
                         <div id="descriptionContainer"> <div id="descriptionContent" class="text-gray-700 text-sm leading-relaxed prose-custom max-w-none collapsible-content line-clamp-3"><asp:Literal ID="litMoTa" runat="server" Mode="PassThrough"></asp:Literal></div> <button type="button" id="toggleDescriptionBtn" onclick="toggleContent('descriptionContent', this)" class="text-sm font-medium text-purple-600 hover:text-purple-800 mt-1 cursor-pointer hover:underline" style="display: none;">Xem thêm</button> </div>
                      </div>
                </div>
            </div>

             <%-- ******** SECTION "CÓ THỂ BẠN QUAN TÂM" ĐÃ BỊ XÓA ******** --%>

             <%-- Phần Đánh Giá Sách (Giữ nguyên) --%>
             <section id="reviewSection" runat="server" class="bg-white p-6 md:p-8 rounded-2xl shadow-xl border border-gray-100">
                   <h3 class="text-2xl font-bold text-gray-800 mb-6 pb-3 border-b border-gray-200">Đánh Giá Sách</h3> <div class="flex flex-col sm:flex-row items-center justify-center sm:justify-start space-y-4 sm:space-y-0 sm:space-x-8 mb-8 p-5 bg-yellow-50 rounded-lg border border-yellow-200"> <div class="text-center"><p class="text-4xl font-bold text-yellow-600 flex items-center justify-center"><asp:Literal ID="litAverageRating" runat="server" Text="0.0"></asp:Literal><i class="fas fa-star text-3xl ml-1"></i></p><p class="text-sm text-gray-600">(<asp:Literal ID="litTotalReviews" runat="server" Text="0"></asp:Literal> lượt đánh giá)</p></div> </div> <h4 class="text-lg font-semibold text-gray-700 mb-5">Bình luận (<asp:Literal ID="litCommentReviewCount" runat="server" Text="0"></asp:Literal>)</h4> <div class="space-y-6"> <asp:Repeater ID="rptComments" runat="server" OnItemDataBound="rptComments_ItemDataBound"> <ItemTemplate> <div class="flex space-x-4 pb-6 border-b border-gray-200 last:border-b-0"> <asp:Image ID="imgCommentAvatar" runat="server" CssClass="h-10 w-10 rounded-full object-cover flex-shrink-0 border border-gray-200 bg-gray-100" ImageUrl='<%# Eval("AnhNenUrl") %>' AlternateText='<%# "Avatar của " + Eval("TenHienThi") %>' /> <div class="flex-1"> <div class="flex items-center justify-between mb-1"><asp:HyperLink ID="hlUserProfileLink" runat="server" NavigateUrl='<%# Eval("IDNguoiDung", "~/WebForm/VangLai/thanhvienvl.aspx?id={0}") %>' Text='<%# Eval("TenHienThi") %>' CssClass="font-semibold text-sm text-blue-600 hover:underline"></asp:HyperLink><span class="text-xs text-gray-500"><%# Eval("EntryDate", "{0:dd/MM/yyyy HH:mm}") %></span></div> <asp:Panel ID="pnlRatingStars" runat="server" CssClass="mb-1.5" Visible='<%# Eval("Rating") != DBNull.Value && Convert.ToInt32(Eval("Rating")) > 0 %>'><div class="text-yellow-500 text-sm flex items-center"><asp:Literal ID="litStars" runat="server"></asp:Literal></div></asp:Panel> <div><div id='commentContent_<%# Eval("EntryType") %>_<%# Eval("EntryID") %>' class="text-sm text-gray-700 leading-relaxed prose-custom max-w-none collapsible-content line-clamp-3"><asp:Literal ID="litCommentText" runat="server" Text='<%# Eval("ContentText") %>' Mode="PassThrough"></asp:Literal></div><button type="button" onclick='toggleContent("commentContent_<%# Eval("EntryType") %>_<%# Eval("EntryID") %>", this)' id='toggleCommentBtn_<%# Eval("EntryType") %>_<%# Eval("EntryID") %>' class="text-xs font-medium text-purple-600 hover:text-purple-800 mt-1 cursor-pointer hover:underline" style="display: none;">Xem thêm</button></div> </div> </div> </ItemTemplate> </asp:Repeater> <asp:Panel ID="pnlNoComments" runat="server" Visible="false" CssClass="text-center text-gray-500 py-8"><p><asp:Label ID="lblNoCommentsText" runat="server" Text="Chưa có bình luận hoặc đánh giá nào."></asp:Label></p></asp:Panel> </div>
             </section>
        </div> <%-- End Book Detail Container --%>
    </div> <%-- End Page Container --%>

    <%-- Popups Yêu cầu Đăng nhập Vãng lai (Giữ nguyên) --%>
    <div id="cartLoginPopupOverlay" class="popup-overlay" onclick="hideCartLoginPopup()"></div> <div id="cartLoginPopup" class="popup-content"> <i class="fas fa-sign-in-alt fa-2x text-blue-500 mb-4"></i> <h3 class="text-xl font-semibold mb-3">Yêu Cầu Đăng Nhập</h3> <p class="text-sm text-gray-600 mb-6">Vui lòng đăng nhập để thêm sách vào giỏ hàng của bạn.</p> <div class="flex justify-center space-x-4"> <button type="button" onclick="redirectToCartLogin();" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition duration-150">Đăng nhập</button> <button type="button" onclick="hideCartLoginPopup();" class="px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-medium transition duration-150">Đóng</button> </div> </div>
    <div id="buyLoginPopupOverlay" class="popup-overlay" onclick="hideBuyLoginPopup()"></div> <div id="buyLoginPopup" class="popup-content"> <i class="fas fa-shopping-bag fa-2x text-emerald-500 mb-4"></i> <h3 class="text-xl font-semibold mb-3">Yêu Cầu Đăng Nhập</h3> <p class="text-sm text-gray-600 mb-6">Vui lòng đăng nhập để thực hiện mua sách này.</p> <div class="flex justify-center space-x-4"> <button type="button" onclick="redirectToBuyLogin();" class="px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition duration-150">Đăng nhập</button> <button type="button" onclick="hideBuyLoginPopup();" class="px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-medium transition duration-150">Đóng</button> </div> </div>

    <%-- JavaScript (Giữ nguyên) --%>
    <script type="text/javascript"> $(document).ready(function () { checkAndShowToggle('#descriptionContent', '#toggleDescriptionBtn'); $('.collapsible-content[id^="commentContent_"]').each(function() { var contentId = '#' + $(this).attr('id'); var btnId = '#toggleCommentBtn_' + contentId.substring('#commentContent_'.length); checkAndShowToggle(contentId, btnId); }); }); function checkAndShowToggle(contentSelector, buttonSelector) { var contentElement = $(contentSelector); if (contentElement.length > 0) { if (contentElement[0].scrollHeight > contentElement[0].clientHeight + 1) { $(buttonSelector).show(); } else { $(buttonSelector).hide(); } } } function toggleContent(contentId, buttonElement) { var contentDiv = $('#' + contentId); contentDiv.toggleClass('line-clamp-3 line-clamp-full'); $(buttonElement).text(contentDiv.hasClass('line-clamp-full') ? 'Ẩn bớt' : 'Xem thêm'); } const cartPopupOverlay = document.getElementById('cartLoginPopupOverlay'); const cartPopup = document.getElementById('cartLoginPopup'); const buyPopupOverlay = document.getElementById('buyLoginPopupOverlay'); const buyPopup = document.getElementById('buyLoginPopup'); function showCartLoginPopup() { fadeIn(cartPopupOverlay); fadeIn(cartPopup); } function hideCartLoginPopup() { fadeOut(cartPopupOverlay); fadeOut(cartPopup); } function redirectToCartLogin() { const currentUrl = window.location.href; window.location.href = '<%= ResolveUrl("~/WebForm/VangLai/dangnhap.aspx") %>?returnUrl=' + encodeURIComponent(currentUrl); } function showBuyLoginPopup() { fadeIn(buyPopupOverlay); fadeIn(buyPopup); } function hideBuyLoginPopup() { fadeOut(buyPopupOverlay); fadeOut(buyPopup); } function redirectToBuyLogin() { const sachId = <%= this.CurrentSachId %>; const targetUserDetailPage = '<%= ResolveUrl("~/WebForm/User/chitietsach_user.aspx") %>'; const targetUrl = targetUserDetailPage + '?IDSach=' + sachId; window.location.href = '<%= ResolveUrl("~/WebForm/VangLai/dangnhap.aspx") %>?returnUrl=' + encodeURIComponent(targetUrl); } function fadeIn(element) { if (!element) return; element.style.opacity = 0; element.style.display = 'block'; requestAnimationFrame(() => { element.style.transition = 'opacity 0.2s ease-out'; element.style.opacity = 1; }); } function fadeOut(element) { if (!element) return; element.style.opacity = 1; element.style.transition = 'opacity 0.2s ease-in'; element.style.opacity = 0; setTimeout(() => { element.style.display = 'none'; }, 200); } </script>
</asp:Content>